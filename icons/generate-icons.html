<!doctype html>
<html lang="zh-CN">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>生成 PNG 图标（192/512）</title>
<style>
  :root { color-scheme: light dark; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Arial, sans-serif; margin: 24px; }
  h1 { font-size: 18px; margin: 0 0 16px; }
  .row { display:flex; gap:12px; align-items:center; flex-wrap: wrap; }
  button { padding: 8px 14px; border-radius: 8px; border: 1px solid #9993; background: #ff8fb1; color: #fff; cursor: pointer; }
  button.secondary { background: #fff0; color: inherit; border-color: #9995; }
  .hint { color: #666; font-size: 13px; margin-top: 10px; }
  canvas { display:none; }
  .thumbs { display:flex; gap:16px; align-items:center; margin-top: 14px; }
  .thumbs > div { text-align:center; font-size:12px; color:#777; }
  .thumbs img { display:block; image-rendering: -webkit-optimize-contrast; border-radius: 20%; width:96px; height:96px; box-shadow: 0 4px 16px #0002; }
  .footer { margin-top: 18px; font-size: 12px; color:#777; }
</style>
<body>
  <h1>生成 PNG 图标（192×192、512×512）</h1>
  <div class="row">
    <button id="gen-all">一键生成并保存两个 PNG</button>
    <button id="gen-192" class="secondary">下载 192×192</button>
    <button id="gen-512" class="secondary">下载 512×512</button>
  </div>
  <div class="hint">说明：这会使用内置的 maskable SVG（与 icons/icon-maskable.svg 一致）在浏览器中绘制，再导出 PNG。可直接下载，或使用“保存”对话框写到 icons/ 目录。</div>

  <div class="thumbs" id="thumbs" hidden>
    <div>
      <img id="prev-192" alt="预览 192" />
      <span>192×192 预览</span>
    </div>
    <div>
      <img id="prev-512" alt="预览 512" />
      <span>512×512 预览</span>
    </div>
  </div>

  <canvas id="c"></canvas>

  <script>
  // Keep in sync with icons/icon-maskable.svg
  const svgStr = `<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"512\" height=\"512\" viewBox=\"0 0 512 512\">\n  <defs>\n    <linearGradient id=\"bg\" x1=\"0\" y1=\"0\" x2=\"1\" y2=\"1\">\n      <stop offset=\"0%\" stop-color=\"#ff8fb1\"/>\n      <stop offset=\"100%\" stop-color=\"#ffd6a5\"/>\n    </linearGradient>\n    <radialGradient id=\"vig\" cx=\"0.2\" cy=\"0.2\" r=\"1.1\">\n      <stop offset=\"60%\" stop-color=\"#ffffff\" stop-opacity=\"0\"/>\n      <stop offset=\"100%\" stop-color=\"#000000\" stop-opacity=\"0.14\"/>\n    </radialGradient>\n    <linearGradient id=\"sheen\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n      <stop offset=\"0%\" stop-color=\"#ffffff\" stop-opacity=\"0.28\"/>\n      <stop offset=\"36%\" stop-color=\"#ffffff\" stop-opacity=\"0.10\"/>\n      <stop offset=\"100%\" stop-color=\"#ffffff\" stop-opacity=\"0\"/>\n    </linearGradient>\n  </defs>\n  <rect x=\"0\" y=\"0\" width=\"512\" height=\"512\" fill=\"url(#bg)\"/>\n  <rect x=\"0\" y=\"0\" width=\"512\" height=\"512\" fill=\"url(#vig)\"/>\n  <rect x=\"0\" y=\"0\" width=\"512\" height=\"512\" fill=\"url(#sheen)\"/>\n  <g transform=\"translate(72,108)\">\n    <g fill=\"#ffffff\" fill-opacity=\"0.98\">\n      <rect x=\"0\" y=\"0\" width=\"320\" height=\"44\" rx=\"22\"/>\n      <rect x=\"0\" y=\"92\" width=\"320\" height=\"44\" rx=\"22\"/>\n      <rect x=\"0\" y=\"184\" width=\"220\" height=\"44\" rx=\"22\"/>\n    </g>\n    <circle cx=\"290\" cy=\"208\" r=\"52\" fill=\"#000000\" opacity=\"0.08\"/>\n    <circle cx=\"290\" cy=\"200\" r=\"52\" fill=\"#ffffff\"/>\n    <g fill=\"#ff8fb1\">\n      <rect x=\"284\" y=\"174\" width=\"12\" height=\"52\" rx=\"6\"/>\n      <rect x=\"264\" y=\"194\" width=\"52\" height=\"12\" rx=\"6\"/>\n    </g>\n  </g>\n</svg>`;

  const toBlob = (canvas) => new Promise((res) => canvas.toBlob(res, 'image/png'));

  async function renderPng(size) {
    const svgUrl = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svgStr);
    const img = new Image();
    img.decoding = 'async';
    img.src = svgUrl;
    await img.decode().catch(()=>{});
    const c = document.getElementById('c');
    c.width = size; c.height = size;
    const ctx = c.getContext('2d');
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = 'high';
    ctx.clearRect(0,0,size,size);
    ctx.drawImage(img, 0, 0, size, size);
    const blob = await toBlob(c);
    return blob;
  }

  async function saveBlob(blob, suggestedName) {
    if (window.showSaveFilePicker) {
      const handle = await showSaveFilePicker({ suggestedName, types: [{ description: 'PNG Image', accept: { 'image/png': ['.png'] } }] });
      const w = await handle.createWritable();
      await w.write(blob); await w.close();
    } else {
      const url = URL.createObjectURL(blob);
      const a = Object.assign(document.createElement('a'), { href: url, download: suggestedName });
      document.body.appendChild(a); a.click(); a.remove();
      setTimeout(()=>URL.revokeObjectURL(url), 1000);
    }
  }

  async function gen(size, name, previewEl) {
    const blob = await renderPng(size);
    if (previewEl) previewEl.src = URL.createObjectURL(blob);
    await saveBlob(blob, name);
  }

  document.getElementById('gen-192').addEventListener('click', async () => {
    document.getElementById('thumbs').hidden = false;
    await gen(192, 'icon-192.png', document.getElementById('prev-192'));
  });
  document.getElementById('gen-512').addEventListener('click', async () => {
    document.getElementById('thumbs').hidden = false;
    await gen(512, 'icon-512.png', document.getElementById('prev-512'));
  });
  document.getElementById('gen-all').addEventListener('click', async () => {
    document.getElementById('thumbs').hidden = false;
    await gen(192, 'icon-192.png', document.getElementById('prev-192'));
    await gen(512, 'icon-512.png', document.getElementById('prev-512'));
  });
  </script>
</body>
</html>

